  
    <section>
        <div class="main_container">
            <div class="category_map">
                <div class="map_container">
                    
                    <%= image_tag('category_map.jpg', :alt => "map") %>
                    <div class="container">
                        <%= render '/layouts/zipsearch' %>
                    </div>
                </div>
            </div>
            <div class="category_body">
                <div class="container">
                    <div class="category_desc">
                        <h1>Product Categories</h1>
                        <p>The products chosen for this guide have undergone meticulous research by the Weston A. Price Foundation. Read more about the selection criteria for each category here.</p>
                    </div> 
                    <div class="category_result">
                
                    <ul >
                            <%= render @categories %>
                           
                        </ul>
                     <div class="clear"></div>
                    </div> 
                    
                    <div class="scroll_down" data-page="2">
                        <p>Scroll down</p>
                        <a href="javascript:void(0);" class="pageload">
                            
                             <%= image_tag("scroll_down.png", :alt => "Scroll Down") %>
                        </a>
                    </div>              
                </div>
            </div>
        </div>
    </section>
<script type="text/javascript">
$(document).ready(function(){
    var next_page ='';
    var allpages = new Array(); 
    function lastAddedLiveFunc()
    {
        if($('.scroll_down').attr('data-page')){
         next_page = $('.scroll_down').attr('data-page')+'a';
         
            if(key_exists(next_page, allpages)){
                     
            }else{
                
                allpages.push(next_page);
           
                $.get('/categories', { page: $('.scroll_down').attr('data-page')}, null, "script");
          
            }
          
        }
         return false;
    };
    


    function key_exists(key, search) {
    if (!search || (search.constructor !== Array && search.constructor !== Object)) {
        return false;
    }
    for (var i = 0; i < search.length; i++) {
        if (search[i] === key) {
            return true;
        }
    }
    return key in search;
    }


    $('.pageload').click(function(){
    
        lastAddedLiveFunc();
    });


    //lastAddedLiveFunc();
    
    $(window).scroll(function(){
        
        var wintop = $(window).scrollTop(), docheight = $(document).height(), winheight = $(window).height();
        var  scrolltrigger = 0.95;
        
        if  ((wintop/(docheight-winheight)) > scrolltrigger) {
         //console.log('scroll bottom');
         lastAddedLiveFunc();

        }
    });
});
</script>